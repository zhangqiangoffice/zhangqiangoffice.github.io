---
title: '微信中下载文件'
tags: []
date: 2016-10-10 17:57:27
---

# 微信中下载文件

微信的浏览器不能下载文件，于是每次都要弹出一个遮罩，告诉用户点击右上角，用浏览器打开，核心的技术要点在于，要识别是否是微信浏览器。

    <span class="hljs-doctype">&lt;!DOCTYPE html&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">html</span> <span class="hljs-attribute">lang</span>=<span class="hljs-value">"en"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">head</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">meta</span> <span class="hljs-attribute">charset</span>=<span class="hljs-value">"UTF-8"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">meta</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"viewport"</span> <span class="hljs-attribute">content</span>=<span class="hljs-value">"width=device-width, initial-scale=1"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">title</span>&gt;</span>微信弹出遮罩<span class="hljs-tag">&lt;/<span class="hljs-title">title</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">body</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">style</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/css"</span>&gt;</span><span class="css">
        *<span class="hljs-rules">{<span class="hljs-rule"><span class="hljs-attribute">margin</span>:<span class="hljs-value"><span class="hljs-number">0</span></span></span>; <span class="hljs-rule"><span class="hljs-attribute">padding</span>:<span class="hljs-value"><span class="hljs-number">0</span></span></span>;<span class="hljs-rule">}</span></span>
        <span class="hljs-tag">img</span><span class="hljs-rules">{<span class="hljs-rule"><span class="hljs-attribute">max-width</span>:<span class="hljs-value"> <span class="hljs-number">100</span>%</span></span>; <span class="hljs-rule"><span class="hljs-attribute">height</span>:<span class="hljs-value"> auto</span></span>;<span class="hljs-rule">}</span></span>
        <span class="hljs-class">.test</span><span class="hljs-rules">{<span class="hljs-rule"><span class="hljs-attribute">height</span>:<span class="hljs-value"> <span class="hljs-number">600</span>px</span></span>; <span class="hljs-rule"><span class="hljs-attribute">max-width</span>:<span class="hljs-value"> <span class="hljs-number">600</span>px</span></span>; <span class="hljs-rule"><span class="hljs-attribute">font-size</span>:<span class="hljs-value"> <span class="hljs-number">40</span>px</span></span>;<span class="hljs-rule">}</span></span>
        </span><span class="hljs-tag">&lt;/<span class="hljs-title">style</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"test"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"http://mp.weixin.qq.com/mp/redirect?url=http://mobile.xinlianwang.com/android/distributor/DistributorApp.apk#weixin.qq.com#wechat_redirect "</span>&gt;</span>有效跳转<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/javascript"</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"http://libs.useso.com/js/jquery/1.9.0/jquery.min.js"</span>&gt;</span><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/javascript"</span>&gt;</span><span class="javascript">
            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">is_weixin</span><span class="hljs-params">()</span> {</span>
                <span class="hljs-keyword">var</span> ua = navigator.userAgent.toLowerCase();
                <span class="hljs-keyword">if</span> (ua.match(<span class="hljs-regexp">/MicroMessenger/i</span>) == <span class="hljs-string">"micromessenger"</span>) {
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                }
            }
            <span class="hljs-keyword">var</span> isWeixin = is_weixin();
            <span class="hljs-keyword">var</span> winHeight = <span class="hljs-keyword">typeof</span> window.innerHeight != <span class="hljs-string">'undefined'</span> ? window.innerHeight : document.documentElement.clientHeight;
            <span class="hljs-keyword">var</span> weixinTip = $(<span class="hljs-string">'&lt;div id="weixinTip"&gt;&lt;p&gt;&lt;img src="live_weixin.png" alt="微信打开"/&gt;&lt;/p&gt;&lt;/div&gt;'</span>);

            <span class="hljs-keyword">if</span>(isWeixin){
                $(<span class="hljs-string">"body"</span>).append(weixinTip);
            }
            $(<span class="hljs-string">"#weixinTip"</span>).css({
                <span class="hljs-string">"position"</span>:<span class="hljs-string">"fixed"</span>,
                <span class="hljs-string">"left"</span>:<span class="hljs-string">"0"</span>,
                <span class="hljs-string">"top"</span>:<span class="hljs-string">"0"</span>,
                <span class="hljs-string">"height"</span>:winHeight,
                <span class="hljs-string">"width"</span>:<span class="hljs-string">"100%"</span>,
                <span class="hljs-string">"z-index"</span>:<span class="hljs-string">"1000"</span>,
                <span class="hljs-string">"background-color"</span>:<span class="hljs-string">"rgba(0,0,0,0.8)"</span>,
                <span class="hljs-string">"filter"</span>:<span class="hljs-string">"alpha(opacity=80)"</span>,
            });
            $(<span class="hljs-string">"#weixinTip p"</span>).css({
                <span class="hljs-string">"text-align"</span>:<span class="hljs-string">"center"</span>,
                <span class="hljs-string">"margin-top"</span>:<span class="hljs-string">"10%"</span>,
                <span class="hljs-string">"padding-left"</span>:<span class="hljs-string">"5%"</span>,
                <span class="hljs-string">"padding-right"</span>:<span class="hljs-string">"5%"</span>
            });
        </span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">body</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">html</span>&gt;</span>